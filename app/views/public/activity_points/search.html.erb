<div class='container-field'>
  <div class="row">
    <div class='col-12'>

      <div id='map'></div>
      <script>
        let map

            // Ê§úÁ¥¢ÁµêÊûú„Çà„ÇäÂú∞Âõ≥„ÅÆË°®Á§∫
            function initMap() {
                geocoder = new google.maps.Geocoder()

            <% if @activity_points.exists? %>
                var LatLng ={lat: <%= @activity_point.latitude %>, lng: <%= @activity_point.longitude %>};
                map = new google.maps.Map(document.getElementById('map'), {
                    center: LatLng,
                    zoom: 13,
                });

            // Ê¥ªÂãïÂú∞ÁÇπ„ÅÆaddress„Åã„ÇâÁ∑ØÂ∫¶ÁµåÂ∫¶„ÇíÂèñÂæó
              <% @activity_points.each do |m| %>
                (function(){
                  // Á∑ØÂ∫¶ÁµåÂ∫¶„ÇíÂÖÉ„Å´„Éî„É≥„Çí„Åï„Åô
                    var marker = new google.maps.Marker({
                        position:{lat: <%= m.latitude %>, lng: <%= m.longitude %>},
                        map: map
                    });
                  })();
              <% end %>
            <% else %>
                map = new google.maps.Map(document.getElementById('map'), {
                    center: {lat: 35.68123620000001, lng:139.7671248},
                    zoom: 13,
                });
            <% end %>
            }

      </script>
      <script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_API_KEY'] %>&callback=initMap" async defer></script>
    </div>

      <div id="btn-menu" class="off">MENU</div>
      <div id="slideL" class="SlideOut">
        <div class="slide-inner">
          <div class="wrap">
              <div id="tab-contents">
                <div id="tab1" class="tab">
                    <%= search_form_for @search do |f| %>
                      <h5 class="col-12 mb-3">„É¶„Éº„Ç∂„ÉºÊ§úÁ¥¢</h5>

                      <div class="col-12 mb-1">
                        <%= f.collection_select :prefecture_eq, JpPrefecture::Prefecture.all, :name, :name, { include_blank: 'ÈÉΩÈÅìÂ∫úÁúå' }, { class: 'custom-select' } %>
                      </div>
                      <div class="col-12 mb-1">
                        <%= f.search_field :spot_or_address_cont, placeholder: "‰ΩèÊâÄ„Åæ„Åü„ÅØ„Çπ„Éù„ÉÉ„ÉàÂêç", class: 'form-control' %>
                      </div>
                      <div class="col-7   mb-1">
                        <%= f.date_field :date_cont, class: 'form-control' %>
                      </div>
                      <div class="col-7  mb-3">
                        <%= f.time_field :time_gteq, include_blank: true, class: 'form-control' %>
                      </div>
                      <div class="col-12 mb-3">
                        <%= f.radio_button :activity_status_eq, '', {:checked => true} %>ÊåáÂÆö„Å™„Åó</br>
                        <%= f.radio_button :activity_status_eq, 0 %>„Ç´„É°„É©„Éû„É≥</br>
                        <%= f.radio_button :activity_status_eq, 1 %>„É¢„Éá„É´
                      </div>
                      <div class="col-12 mb-3">
                        <%= f.submit 'üîç„ÄÄ„Åì„ÅÆÊù°‰ª∂„ÅßÊ§úÁ¥¢ÔºÅ', class: 'button ' %>
                      </div>
                    <% end %>
                </div>
                <div id="tab2" class="tab">
                  <div class="sort-table">
                    <div><%=  link_to "ÂÖ®‰ª∂Ë°®Á§∫", activity_points_path, class: 'button sort' %></div>
                    <div><%=  sort_link @search, :date, "Êó•‰ªòÈ†Ü", class: 'button sort' %></div>
                    <div><%=  sort_link @search, :time, "ÊôÇÈñìÈ†Ü", class: 'button sort' %></div>
                  </div>

                  <div class="jscroll-div search">
                    <div class='jscroll-container table table-hover table-inverse'>
                      <% if @activity_points.exists? %>
                        <% @activity_points.each do |activity_point| %>
                          <%= link_to matching_user_path(activity_point.user), class: "search-link" do %>
                            <div class="row SearchUser-box">
                                <div class="col-2">
                                    <%= image_tag activity_point.user.get_profile_image, class: "table-img" %>
                                </div>
                                <div class="col-7 section">
                                  <p>
                                      <%= activity_point.user.nickname %>

                                      <!--„Éû„ÉÉ„ÉÅ„É≥„Ç∞„Åó„Å¶„ÅÑ„Çã„É¶„Éº„Ç∂„Éº„ÅÆ„Åø„Ç¢„Ç§„Ç≥„É≥Ë°®Á§∫-->
                                      <% if activity_point.user.following?(current_user) && activity_point.user.follower?(current_user) %>
                                        <i class="fas fa-solid fa-hand-holding-heart"></i>

                                      <!--„É≠„Ç∞„Ç§„É≥„É¶„Éº„Ç∂„Éº„Å´‰æùÈ†º„ÇíÈÄÅ„Å£„Åü„É¶„Éº„Ç∂„Éº„ÅÆ„Åø„Ç¢„Ç§„Ç≥„É≥Ë°®Á§∫-->
                                      <% elsif activity_point.user.following?(current_user) %>
                                        <i class="fas fa-solid fa-hand-holding"></i>

                                      <% else %>
                                        <!--„Å©„Å°„Çâ„Åß„ÇÇ„Å™„ÅÑÂ†¥Âêà„ÅØÁ©∫ÁôΩ-->
                                      <% end %></br>

                                  </p>
                                </div>
                            </div>
                          <% end %>
                        <% end %>
                      <% else %>
                        <p>Ê§úÁ¥¢Êù°‰ª∂„Å´Ë©≤ÂΩì„Åô„Çã„É¶„Éº„Ç∂„Éº„ÅØ„ÅÑ„Åæ„Åõ„Çì„Åß„Åó„Åü</p>
                      <% end %>
                    <%= paginate @activity_points %>
                  </div>
                </div>
                </div>
                <div id="tab3" class="tab">
                  <div class="ranks-container">
                    <strong>‰∫∫Ê∞óÊ¥ªÂãïSPOT BEST5 üëë</strong>
                    <p> <%= Date.today %>ÁèæÂú®</p>
                    <!--note[0]„Åå„Çπ„Éù„ÉÉ„ÉàÂêç„ÄÅnote[1]„ÅåÊäïÁ®øÊï∞-->
                    <% lastSpotCount = 0 %>
                    <% j = 1 %>
                    <%  @activity_point_ranks.each.with_index(1) do |note,i| %>
                      <% if i <= 5 %>
                        <% if i == 1 %>
                          <% lastSpotCount = note[1] %>
                        <% end %>
                        <% if note[1] != lastSpotCount %>
                          <% j = i %>
                          <div class="rank-box">
                            Á¨¨<%= j %>‰Ωç
                            <%= note[0] %>
                          </div>
                          <% lastSpotCount = note[1] %>
                        <% else %>
                          <% lastSpotCount = note[1] %>
                          <div class="rank-box">
                            Á¨¨<%= j %>‰Ωç
                            <%= note[0] %>
                          </div>
                        <% end %>
                      <% end %>
                    <% end %>
                  </div>
                </div>
                <div id="tab4" class="tab">
                    <ul class="nav">
                      <li class="nav__item">
                        <%= link_to  user_path(@user), class: "nav__item-link" do %>
                          <i class="fas fa-solid fa-user nav__item-icon"></i>
                          <span class="nav__item-text">„Ç¢„Ç´„Ç¶„É≥„ÉàÊÉÖÂ†±</span>
                        <% end %>
                      </li>
                      <li class="nav__item">
                        <%= link_to  notifications_path, class: "nav__item-link " do %>
                          <% if unchecked_notifications.any? %>
                              <i class="far fa-bell nav__item-icon", style="font-size: 1.5em;" ></i>
                              <span class="nav__item-text">ÈÄöÁü•</span>
                              <i class="fas fa-circle n-circle "></i>
                          <% else %>
                            <i class="far fa-bell nav__item-icon", style="font-size: 1.5em;" ></i>
                            <span class="nav__item-text">ÈÄöÁü•</span>
                          <% end %>
                        <% end %>
                      </li>
                      <li class="nav__item">
                        <%= link_to  users_matchings_path, class: "nav__item-link" do %>
                          <i class="fas fa-solid fa-envelope nav__item-icon"></i>
                          <span class="nav__item-text">„É°„ÉÉ„Çª„Éº„Ç∏</span>
                        <% end %>
                      </li>
                      <li class="nav__item">
                        <%= link_to new_activity_point_path, class: "nav__item-link" do %>
                          <i class="fas fa-solid fa-camera nav__item-icon"></i>
                          <span class="nav__item-text">Ê¥ªÂãïÂú∞ÁÇπ„ÅÆÁôªÈå≤</span>
                        <% end %>
                      </li>
                      <li class="nav__item">
                        <%= link_to  users_unsubscribe_path, class: "nav__item-link" do %>
                          <i class="fas fa-solid fa-reply nav__item-icon"></i>
                          <span class="nav__item-text">ÈÄÄ‰ºö</span>
                        <% end %>
                      </li>
                    </ul>
                </div>
            </div>
              <ul id="tab-menu" class="ul">
                <li><a href="#tab1" class="active">Ê§úÁ¥¢</a></li>
                <li><a href="#tab2" class="">„É¶„Éº„Ç∂„Éº</a></li>
                <li><a href="#tab3" class="">üëë</a></li>
                <li><a href="#tab4" class="">üè†</a></li>
              </ul>
          </div>
        </div>
      </div>
       <%= javascript_pack_tag 'slide_menu' %>
</div>









